@if (vmState$ | async; as state) {
  @if (state.status === 'loaded') {
    @let vm = state.data;
    
    <section class="hero-section">
      <div class="section-inner">
        <!-- <header>
          <div class="header__top">
            <h1>{{ vm.title }}</h1>
            @if (vm.languages.length > 1) {
              <nav class="language-switcher" aria-label="Language selection">
                @for (lang of vm.languages; track lang.code) {
                  <button
                    type="button"
                    (click)="onLanguageSelect(lang.code)"
                    [disabled]="translate.currentLang === lang.code"
                    [class.active]="translate.currentLang === lang.code"
                  >
                    {{ lang.code | uppercase }}
                  </button>
                }
              </nav>
            }
          </div>
          @if (vm.contact; as c) {
            <div aria-label="Kontakt" class="contact">
              <h2>{{ ('frontpage.contact' | translate) || 'Kontakt' }}</h2>
              <address>
                @if (c.name) { <div>{{ c.name }}</div> }
                @if (c.email) { <div><a [href]="'mailto:' + c.email">{{ c.email }}</a></div> }
                @if (c.phone) { <div><a [href]="'tel:' + c.phone">{{ c.phone }}</a></div> }
              </address>
            </div>
          }
        </header> -->

        <!-- @if (vm.news) {
          <div class="news-block">
            <h2>{{ 'news.label' | translate }}</h2>
            @if (vm.news.routed) {
              <a [routerLink]="vm.news.url">{{ vm.news.title }}</a>
            } @else {
              <a [href]="vm.news.url">{{ vm.news.title }}</a>
            }
          </div>
        } -->

        @if (vm.descriptionHtml) {
          <div class="description-block" [innerHTML]="vm.descriptionHtml"></div>
        }
      </div>
    </section>

    @if (vm.references.length) {
      <section class="references-section">
        <div class="section-line">
          <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 1280 120" xml:space="preserve" style="enable-background: new 0 0 1280 120;" preserveAspectRatio="none">
            <path d="M1280,119H616L0,120V47V26.5C44.7,9.9,94.5,5,142.6,2.5c121.1-6.2,242.3,0.4,363.5,6.9c58.8,3.2,117.6,6.4,176.4,8.1c145.5,4.3,267.9,0.3,398.4-4c63.3-2.1,128.5-4.2,199.1-5.5v39L1280,119z"></path>
          </svg>
        </div>
        <div class="section-inner">
          @for (ref of vm.references; track ref.title ?? $index) {
            <div class="reference-block">
              @if (ref.title) {
                <h2 class="reference-block__title">{{ ref.title }}</h2>
              }
              @if (ref.questionTitle) {
                <h3 class="reference-block__question">{{ ref.questionTitle }}</h3>
              }
              @if (ref.content) {
                <p class="reference-block__content">{{ ref.content }}</p>
              }
              @if (ref.link) {
                @if (ref.link.routed) {
                  <a class="reference-block__link" [routerLink]="ref.link.url">
                    {{ ref.link.title || ('button.read_more' | translate) }}
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="link-icon">
                      <path d="M9 18l6-6-6-6"></path>
                    </svg>
                  </a>
                } @else {
                  <a 
                    class="reference-block__link" 
                    [href]="ref.link.url"
                    [attr.target]="ref.link.url.startsWith('http') ? '_blank' : null"
                    rel="noopener"
                  >
                    {{ ref.link.title || ('button.read_more' | translate) }}
                    @if (ref.link.url.startsWith('http')) {
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="link-icon link-icon--external">
                        <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                        <polyline points="15 3 21 3 21 9"></polyline>
                        <line x1="10" y1="14" x2="21" y2="3"></line>
                      </svg>
                    } @else {
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="link-icon">
                        <path d="M9 18l6-6-6-6"></path>
                      </svg>
                    }
                  </a>
                }
              }
            </div>
          }
        </div>
      </section>
    }

    @if (vm.services.length) {
      <section class="services-section">
        <div class="section-line">
          <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 1280 120" xml:space="preserve" style="enable-background: new 0 0 1280 120;" preserveAspectRatio="none">
            <path d="M1280,119H616L0,120V47V26.5C44.7,9.9,94.5,5,142.6,2.5c121.1-6.2,242.3,0.4,363.5,6.9c58.8,3.2,117.6,6.4,176.4,8.1c145.5,4.3,267.9,0.3,398.4-4c63.3-2.1,128.5-4.2,199.1-5.5v39L1280,119z"></path>
          </svg>
        </div>
        <div class="section-inner">
          <h2>{{ 'home.services_title' | translate }}</h2>
          <div class="slides-container">
          <div class="slides-wrapper">
            <button 
              type="button" 
              class="slides-arrow slides-arrow--left" 
              (click)="scrollServices('left')"
              aria-label="Previous services"
            >
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M15 18l-6-6 6-6"/>
              </svg>
            </button>
            
            <div #servicesScroller class="slides-scroller">
              @for (s of vm.services; track s.title) {
                <article class="slides-card">
                  <div class="slides-card__image">
                    @if (s.img) { 
                      <img [src]="s.img" [alt]="s.alt || s.title" (error)="$any($event.target).src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22 viewBox=%220 0 200 200%22%3E%3Crect fill=%22%23f5f5f5%22 width=%22200%22 height=%22200%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 font-family=%22Arial,sans-serif%22 font-size=%2214%22 fill=%22%23999%22 text-anchor=%22middle%22 dy=%22.3em%22%3EPilt puudub%3C/text%3E%3C/svg%3E'" /> 
                    } @else {
                      <svg width="200" height="200" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                        <rect fill="#f5f5f5" width="200" height="200"/>
                        <text x="50%" y="50%" font-family="Arial,sans-serif" font-size="14" fill="#999" text-anchor="middle" dy=".3em">Pilt puudub</text>
                      </svg>
                    }
                  </div>
                  <div class="slides-card__body">
                    <h3 class="slides-card__title">{{ s.title }}</h3>
                    @if (s.content) { <p class="slides-card__text">{{ s.content }}</p> }
                    @if (s.link) {
                      @if (s.link.routed) {
                        <a class="slides-card__link" [routerLink]="s.link.url">
                          {{ s.link.title || ('button.read_more' | translate) }}
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="link-icon">
                            <path d="M9 18l6-6-6-6"></path>
                          </svg>
                        </a>
                      } @else {
                        <a 
                          class="slides-card__link" 
                          [href]="s.link.url"
                          [attr.target]="s.link.url.startsWith('http') ? '_blank' : null"
                          rel="noopener"
                        >
                          {{ s.link.title || ('button.read_more' | translate) }}
                          @if (s.link.url.startsWith('http')) {
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="link-icon link-icon--external">
                              <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                              <polyline points="15 3 21 3 21 9"></polyline>
                              <line x1="10" y1="14" x2="21" y2="3"></line>
                            </svg>
                          } @else {
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="link-icon">
                              <path d="M9 18l6-6-6-6"></path>
                            </svg>
                          }
                        </a>
                      }
                    }
                  </div>
                </article>
              }
            </div>
            
            <button 
              type="button" 
              class="slides-arrow slides-arrow--right" 
              (click)="scrollServices('right')"
              aria-label="Next services"
            >
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 18l6-6-6-6"/>
              </svg>
            </button>
          </div>
        </div>
        </div>
      </section>
    }

    @if (vm.topics.length) {
      <section class="topics-section">
        <div class="section-line">
          <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 1216 254.3" xml:space="preserve" style="enable-background: new 0 0 1216 254.3;" preserveAspectRatio="none">
            <path d="M982.3,3.8c-29.5-0.7-73.6-1.8-88.4-1.9c-6.7-0.1-275-3-350.7-1.5c-58.8,1.2-117.6,3.3-176.4,5.5c-121.2,4.5-242.4,9-363.5,4.7c-1.1,0-2.2-0.1-3.3-0.1v243.8h1216V7.9c-8.1,0-16.2-0.1-24.3-0.2C1121.9,6.8,1052.1,5.3,982.3,3.8z"></path>
          </svg>
        </div>
        <div class="section-inner">
          <div class="topics-cards">
          @for (t of vm.topics; track t.url) {
            <div class="topics-card">
              @if (t.routed) {
                <a [routerLink]="t.url" class="topics-card__link">
                  <h3 class="topics-card__title">{{ t.title }}</h3>
                </a>
              } @else {
                <a [href]="t.url" class="topics-card__link">
                  <h3 class="topics-card__title">{{ t.title }}</h3>
                </a>
              }
            </div>
          }
        </div>
        </div>
      </section>
    }
    @if (vm.links.length) {
      <section class="links-section">
        <div class="section-line">
          <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 1280 120" xml:space="preserve" style="enable-background: new 0 0 1280 120;" preserveAspectRatio="none">
            <path d="M1280,119H616L0,120V47V26.5C44.7,9.9,94.5,5,142.6,2.5c121.1-6.2,242.3,0.4,363.5,6.9c58.8,3.2,117.6,6.4,176.4,8.1c145.5,4.3,267.9,0.3,398.4-4c63.3-2.1,128.5-4.2,199.1-5.5v39L1280,119z"></path>
          </svg>
        </div>
        <div class="section-inner">
          <div class="link-cards">
          @for (l of vm.links; track l.link?.url ?? l.title ?? $index) {
            <div class="link-card">
              <div class="link-card__wrapper">
                <div class="link-card__image">
                  @if (l.img) { 
                    <img [src]="l.img" [alt]="l.alt || l.title || 'Illustratsioon'" (error)="$any($event.target).src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22 viewBox=%220 0 200 200%22%3E%3Crect fill=%22%23f5f5f5%22 width=%22200%22 height=%22200%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 font-family=%22Arial,sans-serif%22 font-size=%2214%22 fill=%22%23999%22 text-anchor=%22middle%22 dy=%22.3em%22%3EPilt puudub%3C/text%3E%3C/svg%3E'" />
                  } @else {
                    <svg width="200" height="200" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                      <rect fill="#f5f5f5" width="200" height="200"/>
                      <text x="50%" y="50%" font-family="Arial,sans-serif" font-size="14" fill="#999" text-anchor="middle" dy=".3em">Pilt puudub</text>
                    </svg>
                  }
                </div>
                <div class="link-card__body">
                  @if (l.title) { <h3 class="link-card__title">{{ l.title }}</h3> }
                  @if (l.desc) { <p class="link-card__description">{{ l.desc }}</p> }
                  @if (l.link) {
                    @if (l.link.routed) {
                      <a class="link-card__link" [routerLink]="l.link.url">
                        {{ l.link.title || ('button.read_more' | translate) }}
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="link-icon">
                          <path d="M9 18l6-6-6-6"></path>
                        </svg>
                      </a>
                    } @else {
                      <a
                        class="link-card__link"
                        [href]="l.link.url"
                        [attr.target]="l.link.url.startsWith('http') ? '_blank' : null"
                        rel="noopener"
                      >
                        {{ l.link.title || ('button.read_more' | translate) }}
                        @if (l.link.url.startsWith('http')) {
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="link-icon link-icon--external">
                            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                            <polyline points="15 3 21 3 21 9"></polyline>
                            <line x1="10" y1="14" x2="21" y2="3"></line>
                          </svg>
                        } @else {
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="link-icon">
                            <path d="M9 18l6-6-6-6"></path>
                          </svg>
                        }
                      </a>
                    }
                  }
                </div>
              </div>
            </div>
          }
        </div>
        </div>
      </section>
    }

    <footer class="footer-section">
      <div class="section-line">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 1280 120" xml:space="preserve" style="enable-background: new 0 0 1280 120;" preserveAspectRatio="none">
          <path d="M1280,119H616L0,120V47V26.5C44.7,9.9,94.5,5,142.6,2.5c121.1-6.2,242.3,0.4,363.5,6.9c58.8,3.2,117.6,6.4,176.4,8.1c145.5,4.3,267.9,0.3,398.4-4c63.3-2.1,128.5-4.2,199.1-5.5v39L1280,119z"></path>
        </svg>
      </div>
      <div class="section-inner">
        <div class="footer-content">
          <!-- <h2 class="footer-title">{{ vm.title }}</h2> -->
          @if (vm.contact; as c) {
            <div class="footer-contact">
              @if (c.name) { 
                <div class="footer-contact__item">
                  <strong>{{ c.name }}</strong>
                </div> 
              }
              @if (c.email) { 
                <div class="footer-contact__item">
                  <a [href]="'mailto:' + c.email">{{ c.email }}</a>
                </div> 
              }
              @if (c.phone) { 
                <div class="footer-contact__item">
                  <a [href]="'tel:' + c.phone">{{ c.phone }}</a>
                </div> 
              }
            </div>
          }
        </div>
      </div>
    </footer>
  } @else if (state.status === 'error') {
    <section class="state state-error" role="alert">
      <p>{{ ('frontpage.errors.loadFailed' | translate) || 'Sisuhaldusest ei õnnestunud andmeid laadida.' }}</p>
    </section>
  } @else {
    <section class="state state-loading" aria-busy="true">
      <p>{{ ('common.loading' | translate) || 'Laadimine…' }}</p>
    </section>
  }
}
